var openBtn="images/dataTables/details_open.png",closeBtn="images/dataTables/details_close.png",subrow_html='<div><table cellpadding="6" cellspacing="0">$d$</table></div>';var sDT,eDT;$.fn.dataTableExt.afnFiltering.push(function(h,e,d){var g=$("#fromDate").val(),b=$("#toDate").val();if((g==""&&b=="")||typeof g==="undefined"||typeof b==="undefined"){return true}var f=parseInt(g===""?"0":g.split("-").join("")),a=parseInt(b===""?"0":b.split("-").join("")),c=parseInt(e[3].split("-").join(""));if((f===0&&c<=a)||(f<=c&&0===a)||(f<=c&&c<=a)){return true}else{return false}});$.fn.dataTableExt.oApi.fnFilterOnReturn=function(c){var a=this,b=$("input",a.fnSettings().aanFeatures.f);$('img[id^="dosearch_'+c.sTableId+'"]').live("click",function(d){if(b.val()!=null&&b.val().trim()!==""){a.fnFilter(b.val())}});a.each(function(d){$.fn.dataTableExt.iApiIndex=d;b.unbind("keyup").bind("keypress",function(f){if(f.which==13){$.fn.dataTableExt.iApiIndex=d;a.fnFilter(b.val())}});return this});return a};$.fn.dataTableExt.oApi.fnNewAjax=function(b,a){if(a!=null){b.sAjaxSource=a}$("input",this.fnSettings().aanFeatures.f).val("");b.oPreviousSearch.sSearch="";this.fnDraw()};var _page={change:{project:function(b,a){if(_page.get.project(b)==true){_page.get.sample(b);createSampleDataTable();_page.change.sample(b,a?a:0);$("#editProjectBtn, #editSampleBtn").attr("disabled",($("#editable").val()!=1))}else{$("#_sampleSelect").html(vs.empty);$("tbody#projectTableBody").empty();if(sDT){sDT.fnNewAjax("eventDetailAjax.action?type=sdt&projectId=0")}$("#editProjectBtn, #editSampleBtn").attr("disabled","true");utils.error.add(utils.error.message.permission)}},sample:function(b,a){_page.get.sdt(b,a)},eventStatus:function(a){gethtmlByType("ces",0,0,a)}},get:{project:function(a){return gethtmlByType("project",a,0,0)},sample:function(a){return gethtmlByType("sample",a,0,0)},sdt:function(b,a){$("#fromDate, #toDate").val("");sDT.fnNewAjax("eventDetailAjax.action?type=sdt&projectId="+b+"&sampleId="+a+"&eventId=0")},edt:function(b,a,c){var d="&fd="+$('input[name="fromDate"]').val()+"&td="+$('input[name="toDate"]').val()}},edit:{project:function(){$("#eventDetailPage").append($("<input/>").attr({type:"hidden",name:"projectName",value:$("#_projectSelect:selected").text()}));$("#eventDetailPage").append($("<input/>").attr({type:"hidden",name:"eventName",value:"ProjectUpdate"}));$("#eventDetailPage").append($("<input/>").attr({type:"hidden",name:"jobType",value:"projectedit"}));this.submit("project")},sampleEvent:function(){var a="";$("#sampleTableBody input[id^=sampleCB]:checked").each(function(c,b){a+=b.id.substr(b.id.indexOf("_")+1)+","});if(a.length===0){utils.error.baloon("Please select sample to load or edit event.")}else{if(!$('input[name="ids"]').length){$("#eventDetailPage").append($("<input/>").attr({type:"hidden",name:"ids"}).val(a))}else{$('input[name="ids"]').val(a)}this.submit("sample")}},submit:function(a){if(!$('input[name="label"]').length){$("#eventDetailPage").append($("<input/>").attr({type:"hidden",name:"label",value:a}))}else{$('input[name="label"]').val(a)}$("#eventDetailPage").attr("target","_blank");$("#eventDetailPage").attr("action","eventLoader.action?filter=su").submit()}},button:{toggleSample:function(){$("#sampleTableDiv").toggle(400);buttonSwitch(null,"sampleToggleImage")},showSample:function(){if(!$("#sampleTableDiv").is(":visible")){this.toggleSample()}}},select:{all:function(){$("#sampleTableBody > tr ").each(function(){$(this).find("td:first > input").attr("checked",true)})}},deselect:{all:function(){$("#sampleTableBody > tr ").each(function(){$(this).find("td:first > input").attr("checked",false)})}}},buttonSwitch=function(b,a){if(b==null){b=document.getElementById(a)}if(b.src.match("details_close")){b.src=openBtn}else{b.src=closeBtn}};function comboBoxChanged(a,b){if(b==="_projectSelect"){if(a.value!=null&&a.value!=0&&a.text!=null&&a.text!=""){_page.change.project(a.value,0);$(".ui-autocomplete-input").val("")}else{$("#_sampleSelect").html(vs.empty)}}else{if(b==="_sampleSelect"){if(a.value!=null&&a.text!=null&&a.text!=""){_page.change.sample($("#_projectSelect").val(),a.value)}}}}function refreshData(){var a=$("#_projectSelect").val();if(a!="0"){_page.change.project(a,0)}else{utils.error.add("Please select a project!")}}var headerList=[];function gethtmlByType(f,b,a,c){$("#loadingImg").show();var e="",d=false;$.ajax({url:f==="project"?"getproject.action":"sharedAjax.action",cache:false,async:f==="project"?false:true,data:"type="+f+"&projectId="+b+"&sampleId="+a+"&eventId="+c,success:function(g){if(g.aaData){if(f=="project"){$(g.aaData).each(function(j,k){if(k&&j==0){$.each(k,function(l,m){if(m){if(l==="editable"){$("#editable").val(m)}else{if(typeof m==="string"&&m.indexOf("http://")>-1){m='<a href="#" onclick="window.open(&quot;'+m+'&quot;);">'+m+"</a>"}e+='<tr class="even"><td width="25%">'+l+"</td><td>"+m+"</td></tr>"}}});d=true}else{if(k&&j==1){var i=$("#sampleTableHeader tr");i.empty();headerList=[];i.append("<th class='tableHeaderStyle'>Sample Name</th>").append("<th class='tableHeaderStyle'>Parent</th>").append("<th class='tableHeaderStyle'>User</th>").append("<th class='tableHeaderStyle'>Date</th>");$.each(k,function(l,m){if(m){i.append("<th class='tableHeaderStyle'>"+m+"</th>")}headerList.push(m)})}}});$("tbody#projectTableBody").html(e)}else{if(f==="sample"){var h=vs.alloption;$(g.aaData).each(function(i,j){if(j){h+=vs.vnoption.replace("$v$",j.id).replace("$n$",j.name)}});if(a==null||a==0){$("#_sampleSelect").html(h)}}else{if(f=="ces"){if(g.aaData&&g.aaData[0]==="success"){_page.get.edt($("#_projectSelect").val(),$("#_sampleSelect").val(),0);d=true}}}}}}});return d}function createSampleDataTable(){if(typeof sDT!=="undefined"){sDT.fnDestroy();$("#sampleTableBody").empty()}sDT=$("#sampleTable").dataTable({sDom:'<"datatable_top"Tlf><"datatable_table"rt><"datatable_bottom"ip>R',bProcessing:true,bServerSide:true,bDestroy:true,sPaginationType:"full_numbers",sAjaxSource:"",iDeferLoading:0,fnServerData:function(a,b,c){if(a!==""){$.ajax({dataType:"json",type:"POST",url:a,data:b,success:function(d){if(d&&d.aaData){var e=[];$.each(d.aaData,function(f,j){var k=[],g;k.push("<input type='checkbox' style='margin-right:6px;' id='sampleCB_"+j.sample.sampleId+"'/>"+j.sampleName,j.parentSampleName,j.actor,j.createdOn);if(j.attributes){for(var h=0;h<headerList.length;h++){k.push(j.attributes[headerList[h]])}}else{g='<tr class="odd"><td colspan="6">No Data</td></tr>';k.push(g)}e.push(k)})}d.aaData=e;c(d);$("#projectTableDivHeader").show();$("#sampleTableDivHeader").show();$("#sampleTableDiv").show();$("#refreshDataBtn").show();$("#loadingImg").hide();utils.error.remove()}})}},aaSorting:[[3,"asc"]],bAutoWidth:false,aoColumnDefs:aoColumns()}).fnFilterOnReturn();$(".datatable_top").append($("<span/>").attr({"class":"input-group-btn"}).append($("<button/>").attr({type:"button","class":"btn btn-default btn-xs",id:"triggerSearchBtn",onclick:"triggerSearch();",style:"height: 24px;"}).append($("<span/>").attr({"class":"glyphicon glyphicon-search","aria-hidden":"true"}))).append($("<button/>").attr({type:"button","class":"btn btn-default btn-xs",id:"selectAllBtn",onclick:"_page.select.all();",style:"margin-left:10px;height: 24px;"}).text("Select All")).append($("<button/>").attr({type:"button","class":"btn btn-default btn-xs",id:"deSelectAllBtn",onclick:"_page.deselect.all();",style:"margin-left:10px;height: 24px;"}).text("Deselect All")))}function triggerSearch(){var a=$("#sampleTable_filter > label > input").val();sDT.fnFilter(a)}function aoColumns(){var d=[];var a=410;d.push({sWidth:"160px",aTargets:[0]},{sWidth:"100px",aTargets:[1]},{sWidth:"100px",aTargets:[2]},{sWidth:"100px",aTargets:[3]});for(var c=0;c<headerList.length;c++){var b=c+4;if(headerList[c].length<10){d.push({sWidth:"100px",aTargets:[b]});a+=100}else{if(headerList[c].length<15){d.push({sWidth:"120px",aTargets:[b]});a+=120}else{if(headerList[c].length<20){d.push({sWidth:"150px",aTargets:[b]});a+=150}else{if(headerList[c].length<25){d.push({sWidth:"170px",aTargets:[b]});a+=170}else{d.push({sWidth:"200px",aTargets:[b]});a+=200}}}}}$("#sampleTable").css("width",a);return d};