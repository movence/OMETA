var _utils={makeAjax:function(b,e,c,a){$.ajax({url:b,cache:false,async:true,data:e,success:function(d){a(d,c)},fail:function(){alert("Ajax Process has failed.")}})},addGridRows:function(b,a){var e=$("#gridListSize").val();if(e===""&&g_sampleIds){e=g_sampleIds.split(",").length}var c=utils.checkPU(a)?1:(e>0)?e:5;if(g_sampleIds==null){for(var d=$("#gridBody > tr").length;d<c;d++){button.add_event(b,a)}}},showPS:function(a){$("#sampleSelectRow").hide();if(utils.checkSR(a)){$("#sampleDetailInputDiv").show();$("#interactive-submission-table tr:last").hide()}else{if(utils.checkPR(a)){$("#projectDetailInputDiv").show()}else{if(utils.checkNP(a)){$("#sampleSelectRow").show()}}}},hidePS:function(){$("#sampleDetailInputDiv, #projectDetailInputDiv").hide();$("#interactive-submission-table tr:last").hide()},ontologify:function(e,a){var c=e.substring(e.lastIndexOf("[")+1,e.length-1).split(",");if(c.length===2){var d=c[0].replace(/^\s+|\s+$/g,"");var b=c[1].replace(/^\s+|\s+$/g,"");a.find("input").autocomplete({source:function(g,f){$.ajax({url:"ontologyAjax.action?t=child",data:{maxRows:12,sw:g.term.replace(" ","%20"),tid:d,ot:b},success:function(h){if(!h||!h.result){utils.error.remove();$('input[id^="ontology"]').removeClass("ui-autocomplete-loading").removeAttr("style");utils.error.add("Ontolo gy search failed. Please try again.")}else{f($.map(h.result,function(i){if(i.ontology){return{label:i.tlabel+" - "+i.ontolabel,value:i.tlabel+"["+i.taccession+"]"}}else{return{label:i,value:"",ontology:null,term:null}}}))}}})},minLength:3,select:function(f,g){return}})}},validation:function(){var a=true;if($("#_projectSelect").val()==="0"||$("#_eventSelect").val()==="0"){utils.error.add("Select a Project and Event");a=false}return a}},callbacks={added:function(b,c){var a=vs.empty;$.each(b.aaData,function(d,e){if(d!=null&&e!=null){a+=vs.vnoption.replace("$v$",e.id).replace("$n$",e.name)}});$("#a_"+c+"Select").append(a);return},sample:function(b){var a=vs.empty;$.each(b.aaData,function(c,d){if(c!=null&&d!=null){a+=vs.vvoption.replace(/\$v\$/g,d.name)}});$("#_sampleSelect, #_parentSampleSelect").html(a);sample_options=a;return},event:function(b){var a=vs.empty;var c=$("#filter").val();if(b.aaData==null&&b.err.indexOf("Forbidden")>0){utils.error.add(utils.error.message.permission);return false}$.each(b,function(d,e){if(e!=null){$.each(e,function(f,g){if(g!=null&&g.lookupValueId!=null&&g.name!=null&&(c==="pr"||!utils.checkPR(g.name))){a+=vs.vnoption.replace("$v$",g.lookupValueId).replace("$n$",g.name)}})}});$("#_eventSelect").html(a);if(typeof oldEventName!=="undefined"&&oldEventName){utils.preSelect("_eventSelect",oldEventName);changes.event(oldEventName,$("#_eventSelect").val())}return},meta:function(f,c){var j="";var h=0;var m="multi(";var b="radio(";var n=false;var e=$("#attributeInputDiv");e.empty();var l=$("#autofill-option-button");l.empty();var g=2;g_eventAttributes=[];g_gridLineCount=0;g_avDic={};var i='<img class="attributeIcon" src="images/icon/info_r.png"/>';var k='<button type="button" class="btn btn-info btn-xs" id="all-$a$" onClick="dataAutofill(this.id)"><i class="glyphicon glyphicon-arrow-down"></i></button><button type="button" id="sequence-$b$" onclick="dataAutofill(this.id)" style="border: none;background:none;padding:0; margin:0;"><img src="images/fill_sequence.png"></button><button type="button" class="btn btn-primary btn-xs" id="clear-$c$" onClick="dataAutofill(this.id)" style="margin-right: $w$px;"><i class="glyphicon glyphicon-remove"></i></button>';var d="",a=$("<tr/>");a.append($("<th/>").addClass("tableHeaderNoBG gridIndex").append("#"));if(utils.checkNP(c)){if(!utils.checkSR(c)){a.append($("<th/>").addClass("tableHeaderNoBG").append('<small class="text-danger">*</small>Sample Name<br/>'));l.append(k.replace("$w$","135").replace("$a$",g).replace("$b$",g).replace("$c$",g));g+=1}else{a.append($("<th/>").addClass("tableHeaderNoBG").append('<small class="text-danger">*</small>Sample Name<br/>'),$("<th/>").addClass("tableHeaderNoBG").append("Parent Sample"),$("<th/>").addClass("tableHeaderNoBG").append("Public<br/>"));l.append(k.replace("$w$","95").replace("$a$",2).replace("$b$",2).replace("$c$",2),k.replace("$w$","190").replace("$a$",3).replace("$b$",3).replace("$c$",3));g=5}}else{if(utils.checkPR(c)){a.append($("<th/>").addClass("tableHeaderNoBG").append('<small class="text-danger">*</small>Project Name<br/>',i),$("<th/>").addClass("tableHeaderNoBG").append("Public<br/>",i));l.append(k.replace("$w$","145").replace("$a$",g).replace("$b$",g).replace("$c$",g));g+=2}}$.each(f.aaData,function(F,y){if(y&&y.eventMetaAttributeId&&y.projectId){g_eventAttributes.push(y);var D=(y.desc&&y.desc!=="");var q=y.requiredDB;var w=(y.ontology&&y.ontology!=="");var z=$('<tr class="gappedTr"/>');z.append($('<td align="right"/>').attr("class",(D?"table-tooltip":"")).attr("data-tooltip",(D?y.desc:"")).append(q?'<small class="text-danger">*</small>':"",(y.label!=null&&y.label!==""?y.label:y.lookupValue.name),"&nbsp;",D?i:""));a.append($("<th/>").addClass("tableHeaderNoBG").attr("data-tooltip",(D?y.desc:"")).append(q?'<small class="text-danger">*</small>':"",(y.label?y.label:y.lookupValue.name)+"<br/>",D?i:""));var t="";var o=(y.options&&y.options!==""&&y.options.indexOf(";")>0);var C=false,A=false;var x=false;t='<input type="hidden" value="'+utils.getProjectName()+'" name="$lt$projectName"/>';t+='<input type="hidden" value="'+y.lookupValue.name+'" name="$lt$attributeName"/>';if(o){C=(y.options.substring(0,m.length)===m)&&(y.options.lastIndexOf(")")===y.options.length-1);A=(y.options.substring(0,b.length)===b)&&(y.options.lastIndexOf(")")===y.options.length-1);var p=C||A?"":'<option value=""></option>';var v=y.options;if(C){v=v.substring(m.length,v.length-1)}else{if(A){v=v.substring(b.length,v.length-1)}}if(v==="0;1"||v==="1;0"){p='<option value="0">No</option><option value="1">Yes</option>'}else{if(v.indexOf("[{")===0&&v.indexOf("parent_attribute")>-1){var u=JSON.parse(v);childOptionsMap={};childFieldName=this.attributeName;for(var s in u){var E=u[s].name;if(E=="parent_attribute"){parentFieldName=u[s].value}else{childOptionsMap[E]=u[s].value}}p="<option>Select "+parentFieldName+" </option>";n=true}else{$.each(v.split(";"),function(H,G){p+='<option value="'+G.split(" - ")[0]+'">'+G+"</option>"})}}t+='<select id="'+(q?"req_":"")+'select_$id$" name="$lt$attributeValue" style="min-width:35px;width:200px;" '+(C||A?'multiple="multiple"':"")+">"+p+"</select>";l.append(k.replace("$w$","130").replace("$a$",g).replace("$b$",g).replace("$c$",g))}else{var B=y.lookupValue.dataType;if(B==="file"){t+='<input type="file" id="'+B+'_$id$" name="$lt$upload" style="width:253px;"/>';l.append('<label style="width: 253px;"></label>')}else{if(B==="date"){t+='<div class="input-group col-sm-5">  <input type="text" id="'+B+'_$id$" name="$lt$attributeValue" value="$val$" style="width:160px;"/>  <label for="'+B+'_$id$" class="input-group-addon" style="padding:4px;"><span><i class="fa fa-calendar"></i></span></label></div>';l.append(k.replace("$w$","110").replace("$a$",g).replace("$b$",g).replace("$c$",g))}else{x=true;t+='<input type="text" id="'+(q?"req_":"")+B+'_$id$" name="$lt$attributeValue" value="$val$" style="width:160px;"/> ';l.append(k.replace("$w$","94").replace("$a$",g).replace("$b$",g).replace("$c$",g))}}}t=t.replace(/\$id\$/g,y.lookupValue.name.replace(/ /g,"_")+"_$id$");g_avDic[y.lookupValue.name]={ma:y,inputElement:t,isText:x,hasOntoloty:w,isSelect:o,isMulti:C,isRadio:A};var r=$("<td/>").append(t.replace(/\$val\$/g,"").replace(/\$id\$/g,"f_"+h).replace(/\$lt\$/g,"beanList["+h+"]."));utils.smartDatePicker(r);if(x&&w){_utils.ontologify(y.desc,r)}if(C){r.find("select").multipleSelect({multipleWidth:"200px"})}else{if(A){r.find("select").multipleSelect({single:true,multipleWidth:"200px"})}}e.append(z.append(r));h++}g+=1;$("#dataSubmissionScope").show()});$("thead#gridHeader").append(a);_utils.addGridRows(null,c);if(n){$("select[id*='select_"+parentFieldName+"']").change({childOptionsMap:childOptionsMap},function(t,u){var s=($(this).val()).split(" - ")[0];var q=($(this).attr("id")).split("_");var r=(q[q.length-2]=="f")?parseInt(q[q.length-1],10)+1:q[q.length-1];var o=t.data.childOptionsMap[s];var v=$("select[id*='select_"+childFieldName+"_"+q[q.length-2]+"_"+r+"']");var p=(u&&u.sampleData==true)?u.sampleAttrMap[childFieldName]:null;v.html("");v.append('<option value=""></option>');if(o){$.each(o.split(";"),function(x,w){v.append('<option value="'+w.split(" - ")[0]+'">'+w+"</option>")});if(p!=null){v.val(p)}}})}$("#autofill-option").width($("thead#gridHeader").width()+70);if(utils.checkPU(c)){_utils.makeAjax("getprojectbyuser.action","projectName="+utils.getProjectName(),"",callbacks.populateProjectInfo)}return},eventAttribute:function(b,a){if(b&&b.aaData){g_gridLineCount=0;$("#gridBody").empty();$('[name^="gridList"]').remove();$.each(b.aaData,function(e,d){if(d.object&&d.attributes){var f={},c=[];$.each(d.attributes,function(h,g){c.push([g.attributeName,g.attributeValue])});f.pn=d.projectName;f.psn=d.object.parentSampleName;f.sn=d.object.sampleName;f.beans=c;button.add_event(null,a,f)}})}$("#loadingImg").hide();$("#sample-pagination-nav").show();$("#pagination-loadingImg").hide();$("#gridInputDiv").show();$("#autofill-option").width($("thead#gridHeader").width()+70)},populateProjectInfo:function(c,e){if(c&&c.aaData){var f=c.aaData[1].attributes;for(var d in f){var l=d;var k=f[d];while(l.indexOf(" ")>-1){l=l.replace(" ","_")}var h=$("input[id*='"+l.replace(/([ #;&,.+*~\':"!^$[\]()=>|\/@])/g,"\\$1")+"']");if(h.length>0){h.val(k)}else{var a=$("select[id*='"+l+"']");if(a.get(0)){if(a.get(0).getAttribute("multiple")==null){a.val(k)}else{var g=k.split(",");for(var b in g){if(g[b].charAt(0)==" "){g[b]=g[b].replace(" ","")}a.multipleSelect("setSelects",g)}}}else{a.val(k)}}}}},populateSampleInfo:function(f,c){if(f&&f.aaData){var h;var d=(c==="sampleName");if(d){$('#attributeInputDiv input[type="text"]').val("")}else{h=c.charAt(9);$("#gridBody .borderBottom:eq("+h+') input[type="text"][name!="gridList['+h+'].sampleName"]').val("")}$('select[id^="select_"], select[id^="req_select_"]').each(function(){var j=$(this);var i=j.get(0).getAttribute("name");if(d?(i.indexOf("gridList")<0):(i.indexOf("gridList")>-1&&i.charAt(9)===h)){if(j.get(0).getAttribute("multiple")==null){j.val("")}else{j.multipleSelect("uncheckAll")}}});$('input[type="file"][id^="file_"], input[type="file"][id^="req_file_"]').each(function(){var j=$(this);var i=j.get(0).getAttribute("name");if(d?(i.indexOf("gridList")<0):i.indexOf("gridList")>-1&&i.charAt(9)===h){j.prev("strong").remove()}});$('input[type="radio"][class="radio_attr"], input[type="radio"][class="req_radio_attr"]').each(function(){var j=$(this);var i=j.get(0).getAttribute("name");if(d?i.indexOf("gridList")<0:i.indexOf("gridList")>-1&&i.charAt(9)===h){j.prop("checked",false)}});var b=f.aaData[0];for(var g in b){var o=g;var n=b[g];var l=(c==="sampleName")?$('input[name^="beanList"][value="'+o+'"]').next():$('input[name^="gridList['+h+'"][value="'+o+'"]').next();if(l.is("div")){l=l.children(":first")}var m=l.get(0);if(m){if(m.getAttribute("type")=="file"){$(m).before("<strong>"+n.substring(n.indexOf("_")+1)+"</strong>")}else{if(m.getAttribute("type")=="radio"){var a=m.getAttribute("name");$("input[name="+a+"][value="+n+"]").attr("checked","checked")}else{if(m.getAttribute("multiple")==null){l.val(n);l.trigger("change",[{sampleData:true,sampleAttrMap:b}])}else{var k=n.split(",");for(var e in k){if(k[e].charAt(0)==" "){k[e]=k[e].replace(" ","")}l.multipleSelect("setSelects",k)}}}}}else{l.val(n)}}}}},changes={project:function(a){$("#loadingImg").show();_utils.hidePS();g_sampleIds=null;$("#_sampleSelect").attr("disabled",false);$("#_eventSelect").attr("disabled",false);_utils.makeAjax("sharedAjax.action","type=event&projectId="+a+"&filter="+$("#filter").val(),null,callbacks.event);clearSampleAutoComplete();$("#confirmDiv").empty();$("#_sampleSelect+.ui-autocomplete-input, #_eventSelect+.ui-autocomplete-input").val("");$("#loadingImg").hide()},sample:function(){},event:function(b,e){$("#loadingImg").show();_utils.hidePS();$("#confirmDiv").empty();$("#saveButton, #validateButton, #submitButton").attr("disabled",false);if(utils.getLoadType()==="form"){_utils.showPS(b)}_utils.makeAjax("sharedAjax.action","type=ea&projectName="+utils.getProjectName()+"&eventName="+b,b,callbacks.meta);if(utils.checkNP(b)&&g_sampleIds){$("#sample-pagination-nav").hide();$("#gridInputDiv").hide();sampleData=[];$("#sample-pagination-nav ul").empty();var a=g_sampleIds.split(",");$("input[name='ids']").remove();$("#eventLoaderPage").append($("<input/>").attr({type:"hidden",name:"ids"}).val(g_sampleIds));if(a.length<=100){_utils.makeAjax("sharedAjax.action","type=sa&projectName="+utils.getProjectName()+"&projectId="+$("#_projectSelect").val()+"&eventId="+e+"&eventName="+b+"&ids="+g_sampleIds,b,callbacks.eventAttribute);sampleData.push(a)}else{var d="";for(var c=0;c<a.length;c++){d+=a[c];if(c!=0&&(c+1)%100==0){sampleData.push(d);d=""}else{d+=","}}if(d!=""||d!=","){sampleData.push(d)}_utils.makeAjax("sharedAjax.action","type=sa&projectName="+utils.getProjectName()+"&projectId="+$("#_projectSelect").val()+"&eventId="+e+"&eventName="+b+"&ids="+sampleData[g_sampleArrIndex],b,callbacks.eventAttribute);for(var c=0;c<sampleData.length;c++){$("#sample-pagination-nav ul").append('<li><a onclick="getNextSamples('+c+","+e+",'"+b+"')\">"+(c+1)+"</a></li>")}$("#sample-pagination-nav ul li:nth-child("+(parseInt(g_sampleArrIndex,10)+1)+")").addClass("active");$("#pagination-warning").show()}}else{$("#loadingImg").hide()}}};var sampleData=[];function getNextSamples(b,c,a){$("#pagination-loadingImg").show();g_sampleArrIndex=b;utils.error.remove();$("#sample-pagination-nav ul li").removeClass("active");$("#sample-pagination-nav ul li:nth-child("+(b+1)+")").addClass("active");_utils.makeAjax("sharedAjax.action","type=sa&projectName="+utils.getProjectName()+"&projectId="+$("#_projectSelect").val()+"&eventId="+c+"&eventName="+a+"&ids="+sampleData[b],a,callbacks.eventAttribute)}var button={submit:function(f){var o=$('input[name="loadType"]:radio:checked').val();if(o==="form"){var a=true,m="";var n=$("#attributeInputDiv > tr > td");n.find('[id^="req_"]:not(:hidden), [id^="req_select_"]').each(function(r,q){var e=$(q);if(e.val()===null||e.val()===""){a=false;m+="&nbsp;&nbsp;"+e.siblings('[name$="attributeName"]').val()+"<br />"}});if(!a){utils.error.add("Required Field(s):<br/>"+m);return}var k=true;n.find('[name$=".attributeValue"], [name$=".upload"]').each(function(r,q){var e=$(q);if(e.val()!==null&&e.val()!==""){k=false}});if(k){utils.error.add("Data submission form is empty. Please insert value(s).");return}}else{if(o==="grid"){var d=true,a=true,k=true;m="";var n=$("#gridBody > tr > td").find(":not(:hidden):not(option), select[multiple=multiple]");var c=[],j="",h=true,b=true,p=false;if(utils.checkPR($("#_eventSelect option:selected").text())){n.each(function(r,q){var e=$(q);if(e.val()===null||e.val()===""){if(e.attr("id").indexOf("req_")!==-1){b=false;j+="&nbsp;&nbsp;"+e.siblings('[name$="attributeName"]').val()+"<br />"}else{if(e.attr("id")&&e.attr("id").indexOf("projectName")!==-1){b=false;j+="&nbsp;&nbsp;Project Name<br />"}}}else{if(e.attr("name").indexOf("projectPublic")===-1){h=false;if(e.attr("id")&&e.attr("id").indexOf("projectName")===-1){p=true}}}if($(this).attr("id")&&$(this).parent().is(":last-child")){c.push({e:h,r:b,m:j,h:p});h=true;j="";b=true;p=false}})}else{if(utils.checkSR($("#_eventSelect option:selected").text())){n.each(function(r,q){var e=$(q);if(e.val()===null||e.val()===""){if(e.attr("id")&&e.attr("id").indexOf("req_")!==-1){b=false;j+="&nbsp;&nbsp;"+e.siblings('[name$="attributeName"]').val()+"<br />"}else{if(e.attr("id")&&e.attr("id").indexOf("sampleName")!==-1){b=false;j+="&nbsp;&nbsp;Sample Name<br />"}}}else{if(e.is("select")){if(e.find("option:eq(0)").val()===""){h=false;p=true}}else{h=false;if(e.attr("id")&&e.attr("id").indexOf("sampleName")===-1){p=true}}}if($(this).attr("id")&&$(this).parents("td").is(":last-child")){c.push({e:h,r:b,m:j,h:p});h=true;j="";b=true;p=false}})}else{n.each(function(r,q){var e=$(q);if(e.val()===null||e.val()===""){if(e.attr("id")&&e.attr("id").indexOf("req_")!==-1){b=false;j+="&nbsp;&nbsp;"+e.siblings('[name$="attributeName"]').val()+"<br />"}else{if(e.attr("id")&&e.attr("id").indexOf("sampleSelect")!==-1){b=false;j+="&nbsp;&nbsp;Sample Name<br />"}}}else{if(e.is("select")){if(e.find("option:eq(0)").val()===""){h=false;p=true}}else{h=false;if(e.attr("id")&&e.attr("id").indexOf("sampleSelect")===-1){p=true}}}if($(this).attr("id")&&$(this).parents("td").is(":last-child")){c.push({e:h,r:b,m:j,h:p});h=true;j="";b=true;p=false}})}}for(var g=0;g<c.length;++g){var l=c[g].e;if(l===false){k=false;if(c[g].r===false){a=false;m+="&nbsp;&nbsp;"+(g+1)+" : "+c[g].m+"<br>"}else{if(c[g].h===false){d=false;m+="&nbsp;&nbsp;"+(g+1)+" :  Data submission is empty. Please insert value(s). <br>"}}}}if(k){utils.error.add("There is no data to submit!");return}else{if(!a){utils.error.add("Required Field(s):<br/>"+m);return}else{if(!d){utils.error.add("Error(s):<br/>"+m);return}else{for(var g=0;g<c.length;++g){if(c[g].e===true){$("#gridBody").find("tr td.gridIndex").each(function(){if($(this).html()==(g+1)){$(this).parent().remove()}})}}}}}}}this.submit_form(o,f)},template:function(){if(_utils.validation()){$.openPopupLayer({name:"LPopupTemplateSelect",width:450,url:"popup.action?t=sel_t&projectName="+$("#_projectSelect option:selected").text()+"&projectId="+$("#_projectSelect").val()+"&eventName="+$("#_eventSelect option:selected").text()+"&eventId="+$("#_eventSelect").val()+"&ids="+(g_sampleIds?g_sampleIds:"")})}},submit_form:function(g,e){$("#projectName").val(utils.getProjectName());var f=utils.getEventName();$("#eventName").val(f);var d=$("#sampleSelect").val();if(d!=null){$("#sampleName").remove()}else{d=$("#sampleName").val()}$("#jobType").val(g);$("#status").val(e);if(g==="form"){if(utils.checkPR(f)){var c=$("#_projectName").val();if(c==null||c===""){utils.error.add("Project Name is empty!");return}}else{if(utils.checkSR(f)){var b=$("#_sampleName").val();if(b==null||b===""){utils.error.add("Sample Name is empty!");return}}else{if(d.length==0&&f.toLowerCase().indexOf("project")<0){utils.error.add("Data cannot be submitted without sample. Please select a sample! If the project does not have any sample, create a new one first!");return}}}}else{if(g==="file"){var a=$("#dataTemplate");if(a.val()==null||a.val().length===0){utils.error.add("Please select a data template file.");return false}}}$("<input>").attr({id:"sampleArrIndex",name:"sampleArrIndex",value:g_sampleArrIndex}).css("display","none").appendTo($("form#eventLoaderPage"));$("#loadingImg").show();$("#pagination-loadingImg").show();$("form#eventLoaderPage").submit()},add_event:function(e,c,d){var i=e?e:utils.getProjectName(),g=c?c:utils.getEventName(),b=$('<tr class="borderBottom"/>');b.append('<td class="gridIndex">'+(g_gridLineCount+1)+"</td>");if(i&&g){if(utils.checkNP(g)){if(utils.checkSR(g)){b.append($("<td/>").append($("<input/>").attr({type:"text",name:"gridList["+g_gridLineCount+"].sampleName",id:"_sampleName"+g_gridLineCount,style:"width:160px"})));b.append($("<td/>").append($("<div/>").attr({"class":"input-group"}).append($("<input/>").attr({name:"gridList["+g_gridLineCount+"].parentSampleName",id:"_parentSelect"+g_gridLineCount,"class":"form-control search-box",style:"width: 168px;"})).append($("<span/>").attr({"class":"input-group-btn"}).append($("<button/>").attr({type:"button","class":"btn btn-default btn-xs search-button",id:"_searchParentSample"+g_gridLineCount,onclick:"searchSamples(this.id);"}).append($("<span/>").attr({"class":"glyphicon glyphicon-search","aria-hidden":"true"}))))));b.append($("<td/>").append($("<select/>").attr({name:"gridList["+g_gridLineCount+"].samplePublic",style:"width:52px"}).append(vs.nyoption)))}else{b.append($("<td/>").attr({style:"width: 205px;"}).append($("<div/>").attr({"class":"input-group"}).append($("<input/>").attr({type:"text",name:"gridList["+g_gridLineCount+"].sampleName",id:"_sampleSelect"+g_gridLineCount,"class":"form-control search-box",style:"width: 168px;"})).append($("<span/>").attr({"class":"input-group-btn"}).append($("<button/>").attr({type:"button","class":"btn btn-default btn-xs search-button",id:"_searchSample"+g_gridLineCount,onclick:"searchSamples(this.id);"}).append($("<span/>").attr({"class":"glyphicon glyphicon-search","aria-hidden":"true"}))))))}}else{if(utils.checkPR(g)){b.append($("<td/>").append($("<input/>").attr({type:"text",name:"gridList["+g_gridLineCount+"].projectName",id:"_projectName"+g_gridLineCount,style:"width:160px"})));b.append($("<td/>").append($("<select/>").attr({name:"gridList["+g_gridLineCount+"].projectPublic",style:"width:52px"}).append(vs.nyoption)))}}var f,h,a=0;var j=((d&&d.beans)?d.beans:null);$.each(g_avDic,function(l,k){h=null;if(j){$.each(j,function(o,p){if(k.ma.lookupValue.name===p[0]){h=p}})}f="gridList["+g_gridLineCount+"].beanList["+(a++)+"].";var n=g_avDic[k.ma.lookupValue.name]["inputElement"];n=n.replace("$val$",(h?h[1]:""));if(n.indexOf('type="file"')>=0){if(h){n+=("<strong>"+h[1].substring(h[1].indexOf("_")+1)+"</strong>")}}var m=$("<td/>").append(n.replace(/\$lt\$/g,f).replace(/\$id\$/g,"g_"+g_gridLineCount));if(k.isSelect===true&&h){utils.preSelectWithNode(m,h[1])}if(k.isMulti===true){m.find("select").multipleSelect()}else{if(k.isRadio===true){m.find("select").multipleSelect({single:true})}}b.append(m)});utils.smartDatePicker(b);$("#gridBody").append(b);if(d){if(utils.checkSR(g)){$("input:text#_sampleName"+g_gridLineCount).val(d.sn);$('input[name="gridList['+g_gridLineCount+'].parentSampleName"]').val(d.psn);$('select[name="gridList['+g_gridLineCount+'].samplePublic"]').val(d.sp)}else{if(utils.checkPR(g)){$("#_projectName"+g_gridLineCount).val(d.pn);$('select[name="gridList['+g_gridLineCount+'].projectPublic"]').val(d.pp)}else{$('input[name="gridList['+g_gridLineCount+'].sampleName"]').val(d.sn)}}}$('select[id^="_"]').combobox();$("#gridBody .hasDatepicker").parent("td").attr("style","min-width:163px !important;");$("#gridBody .ui-autocomplete-input").parent("td").attr("style","min-width:200px !important;");if(g_gridLineCount==1){$("#gridRemoveLineButton").removeAttr("disabled")}g_gridLineCount++}},remove_event:function(){var a=$("#gridBody tr:last-child");if(!a.is("#gridBody tr:first-child")){if(a.is("#gridBody tr:nth-child(2)")){$("#gridRemoveLineButton").attr("disabled",true)}a.remove();g_gridLineCount--}},clear_form:function(){$("#_projectSelect").val(0);utils.preSelect("_projectSelect",0);changes.project(0);$("#_parentProjectSelect, #_parentSampleSelect").combobox();this.clear_attr();$("#dataSubmissionScope").hide()},clear_attr:function(){utils.error.remove();$("#attributeInputDiv, #gridHeader, #gridBody").html("");$('[name^="beanList"], [name^="gridList"]').remove();$("#_projectName, #_parentProjectSelect~input, #_sampleName, #_parentSampleSelect~input").val("")},projectPopup:function(){var b=utils.getProjectName();if(!b){utils.error.add("Please select a project");return}else{var c=utils.getProjectId();var a=$(window).width()*3/4;a=a<550?550:a;$.openPopupLayer({name:"LPopupProjectDetails",width:a,height:50,url:"popup.action?t=projectDetails_pop&projectName="+b+"&projectId="+c})}}};function comboBoxChanged(c,e){if(e==="_projectSelect"){button.clear_attr();$("#saveButton, #validateButton, #submitButton").attr("disabled",true);$("#eventSelectRow").find("input.ui-widget, button.ui-widget").prop("disabled",false);$("#_eventSelect").html(vs.empty);if(c.value!=null&&c.value!=0&&c.text!=null&&c.text!=""){changes.project(c.value)}else{$("#_sampleSelect").html(vs.empty);$("#_eventSelect").html(vs.empty)}$("#dataSubmissionScope").hide()}else{if(e==="_eventSelect"){button.clear_attr();if(c.value&&c.value!=0&&c.text&&c.text!=""){$('input[name="ids"]').remove();changes.event(c.text,c.value);var d=$('input[name="loadType"]:checked').val();var b=c.text;if(utils.checkSR(b)||d==="grid"){$("#interactive-submission-table tr:last").hide()}else{if(!utils.checkPR(b)&&utils.getEventName(b).toLowerCase().indexOf("project")<0){$("#interactive-submission-table tr:last").show()}}if(utils.checkPU(b)){$("#gridAddLineButton").prop("disabled",true);$("#gridRemoveLineButton").prop("disabled",true)}else{$("#gridAddLineButton").removeAttr("disabled");$("#gridRemoveLineButton").removeAttr("disabled")}var a=$("#sampleSelect").val();if(a&&a!=""&&!utils.checkPU(b)){_utils.makeAjax("getsample.action","type=single&projectId="+utils.getProjectId()+"&sampleVal="+a,"sampleName",callbacks.populateSampleInfo)}}}else{if(e==="_sampleSelect"){}}}}function dataAutofill(f){var d=f.split("-");var c=$("#gridBody tr td:nth-child("+d[1]+") input, #gridBody tr td:nth-child("+d[1]+") select");if(d[0]==="all"){var e=$("#s-name-autofill").val();var b=1;c.each(function(j,h){if(h.id!=""||h.className!=""){var l=$(h),k=false;if(typeof l.attr("multiple")!=="undefined"){k=true}if(!k){if($(h).val()!=""){var g=$("#gridHeader tr th:nth-child("+d[1]+")").text().replace("*","");confirmBox(j,"Are you sure to overwrite ["+b+":"+g+"] ?",function(){l.val(e)})}else{l.val(e)}}else{l.find("option[value='"+e+"']").prop("selected",true);l.multipleSelect("refresh")}b+=1}})}else{if(d[0]==="sequence"){var e=$("#s-name-autofill").val();var b=1;c.each(function(j,h){if(h.id!=""||h.className!=""){var m=$(h),l=false;if(typeof m.attr("multiple")!=="undefined"){l=true}var k=e+b;if(!l){if($(h).val()!=""){var g=$("#gridHeader tr th:nth-child("+d[1]+")").text().replace("*","");confirmBox(j,"Are you sure to overwrite ["+b+":"+g+"] ?",function(){m.val(k)})}else{m.val(k)}}else{m.find("option[value='"+k+"']").prop("selected",true);m.multipleSelect("refresh")}b+=1}})}else{var a=$("#gridHeader tr th:nth-child("+d[1]+")").text().replace("*","");confirmBox("Remove","Are you sure to delete contents in "+a+" ?",function(){c.each(function(h,g){var j=$(g);if(typeof j.attr("multiple")==="undefined"){j.val("")}else{j.find("option").each(function(l,k){$(this).prop("selected",false)});j.multipleSelect("refresh")}})})}}}function confirmBox(b,e,d){var c='<div style="margin-top: 10px;" id="confirm'+b+'"><label class="confirm-text" style="margin-right: 5px;color:#a90329;">'+e+'</label><button class="yes btn btn-success btn-xs" type="button" style="margin-right:2px">Yes</button><button class="no btn btn-primary btn-xs" type="button">No</button></div>';$("#confirm"+b).remove();$("#confirmDiv").append(c);var a=$("#confirm"+b);a.show();$("#confirm"+b+" > .yes").click(function(){d();a.remove();d=function(){}});$("#confirm"+b+" > .no").click(function(){a.remove();d=function(){}})}function toBulk(){utils.error.remove();$("#dropBoxDiv, #toInteractiveP").slideDown(400);$("#files > p").remove();$("#progress > .bar").css("width","0%");$("#uploadFile").fileupload({add:function(g,f){utils.error.remove();var d=/(\.)(csv|zip)$/i;var b=f.files[0]["name"].length&&d.test(f.files[0]["name"]);var c=$("<p/>").text(f.files[0]["name"]+" ("+utils.formatFileSize(f.files[0]["size"])+")");if(!b){c.append($('&nbsp;<strong class="error text-danger"/>').text("[Only .csv and .zip files are supported]"));f.files.length=0}var a=$('<button type="button" class="btn btn-xs btn-warning cancel" style="margin-left:15px;" />').text("Cancel").click(function(){f.abort();f.files.length=0;$(this).parent().remove()});f.context=c.append(a).appendTo($("#files"));$("#uploadFilesBtn").on("click",function(h){h.preventDefault();if(f.files.length>0){f.submit()}})},dataType:"json",sequentialUploads:true,done:function(b,a){$("#files").find("p").each(function(e,d){var c=$(d);if(c.text().indexOf(a.files[0].name)>=0){if(c.find("span.label").length<1){c.prepend($('<span class="label label-info" style="margin-right: 10px;"/>').text("Uploaded Successfully"));c.find("button").hide()}}});a.files.length=0},dropZone:$("#dropzone"),progressall:function(c,b){var a=parseInt(b.loaded/b.total*100,10);$("#progress .bar").css("width",a+"%")}});$(document).bind("dragover",function(d){var f=$("#dropzone"),c=window.dropZoneTimeout;if(!c){f.addClass("in")}else{clearTimeout(c)}var b=false,a=d.target;do{if(a===f[0]){b=true;break}a=a.parentNode}while(a!=null);if(b){f.addClass("hover")}else{f.removeClass("hover")}window.dropZoneTimeout=setTimeout(function(){window.dropZoneTimeout=null;f.removeClass("in hover")},100)});$(document).bind("drop dragover",function(a){a.preventDefault()})}function toInteractive(){utils.error.remove();$("#dropBoxDiv, #toInteractiveP").hide();$("#interactiveDiv, #toBulkP").slideDown(400)}function searchSamples(b){var e=[];var g=(b.indexOf("Parent")>-1)?b.replace("searchParentSample","parentSelect"):b.replace("searchSample","sampleSelect");var a=$("#"+g);var d=a.val();var h;var f=0;var i=25;var c=true;fetchSample(e,d,f*25,i);a.autocomplete({source:function(l,k){if(!h){h=$(this.menu.element)}var m=l.term;var j=[];$.each(e,function(o,n){if(n.value.toLowerCase().indexOf(m.toLowerCase())>-1){j.push(n)}else{if(n.value==="loadMoreData"){j.push(n)}}});k(j)},select:function(k,j){if(j.item.value==="loadMoreData"){++f;e.pop();fetchSample(e,d,f*25,i);a.blur();$(this).autocomplete("search");c=false;return false}else{c=true;_utils.makeAjax("getsample.action","type=single&subType=sample&projectId="+utils.getProjectId()+"&sampleVal="+j.item.value,this.name,callbacks.populateSampleInfo)}},minLength:0,delay:0}).focus(function(){window.pageIndex=0;$(this).autocomplete("search")}).data("autocomplete").close=function(j){if(c){clearTimeout(this.closing),this.menu.element.is(":visible")&&(this.menu.element.hide(),this.menu.deactivate(),this._trigger("close",j))}else{return false}};$(document).mouseup(function(j){if((!a.is(j.target)&&a.has(j.target).length===0)&&(h&&!h.is(j.target)&&h.has(j.target).length===0)){h.hide()}})}function fetchSample(c,d,b,f){var e=$("#sampleLoadingImg");var a=utils.getProjectId();if(a!=0){$.ajax({url:"sharedAjax.action",data:"type=sample&projectId="+a+"&sampleVal="+d+"&firstResult="+b+"&maxResult="+f,cache:false,async:false,beforeSend:function(){e.show()},success:function(g){$.each(g.aaData,function(h,i){if(h!=null&&i!=null){c.push({label:i.name,value:i.name})}});if(g.aaData.length==25){c.push({label:"Load More Sample...",value:"loadMoreData"})}e.hide()}})}}function clearSampleAutoComplete(){var b=$("#sampleSelect"),a=$("#parentSelect");b.val("         ");a.val("         ");$("#searchSample").trigger("click");$("#searchParentSample").trigger("click");b.val("");a.val("")};